import plotly.graph_objects as go

# å®šä¹‰èŠ‚ç‚¹ï¼ˆä¼˜åŒ–æ ‡ç­¾æ˜¾ç¤ºï¼‰
nodes = dict(
    label=[
        "ç¯å¢ƒäº¤äº’<br>æ”¶é›†(sâ‚œ, aâ‚œ, râ‚œ, sâ‚œâ‚Šâ‚)",
        "è½¨è¿¹ç¼“å­˜<br>å­˜å‚¨{(sâ‚œ, aâ‚œ, râ‚œ)}",
        "Criticç½‘ç»œ<br>V_Ï•(sâ‚œ)",
        "æ—¶åºå·®åˆ†<br>Î´â‚œ = râ‚œ + Î³V(sâ‚œâ‚Šâ‚) - V(sâ‚œ)",
        "GAEè®¡ç®—<br>Aâ‚œ = Î£(Î³Î»)áµ Î´â‚œâ‚Šâ‚–",
        "æ—§ç­–ç•¥ç½‘ç»œ<br>Ï€_old(aâ‚œ|sâ‚œ)",
        "æ–°ç­–ç•¥ç½‘ç»œ<br>Ï€_Î¸(aâ‚œ|sâ‚œ)",
        "æ¦‚ç‡æ¯”<br>râ‚œ(Î¸) = Ï€_Î¸/Ï€_old",
        "ClippedæŸå¤±<br>min(rA, clip(r,1Â±Îµ)A)",
        "ä»·å€¼æŸå¤±<br>(V_Ï• - Râ‚œ)Â²",
        "æŠ˜æ‰£å›æŠ¥<br>Râ‚œ = Î£Î³áµrâ‚œâ‚Šâ‚–",
        "æ€»æŸå¤±<br>L = Lá´¬ - câ‚Lâ±½ + câ‚‚H",
        "å‚æ•°æ›´æ–°<br>Î¸ â† Î¸ - Î±âˆ‡L",
        "æ—§ç­–ç•¥åŒæ­¥<br>Î¸_old â† Î¸"
    ],
    color=[
        "rgba(249, 231, 159, 0.8)",  # ç¯å¢ƒäº¤äº’
        "rgba(213, 219, 219, 0.8)",  # è½¨è¿¹ç¼“å­˜
        "rgba(174, 214, 241, 0.8)",  # Criticç½‘ç»œ
        "rgba(133, 193, 233, 0.8)",  # æ—¶åºå·®åˆ†
        "rgba(52, 152, 219, 0.8)",   # GAEè®¡ç®—
        "rgba(250, 219, 216, 0.8)",  # æ—§ç­–ç•¥
        "rgba(245, 183, 177, 0.8)",  # æ–°ç­–ç•¥
        "rgba(231, 76, 60, 0.8)",    # æ¦‚ç‡æ¯”
        "rgba(31, 97, 141, 0.8)",    # ClippedæŸå¤±
        "rgba(171, 235, 198, 0.8)",  # ä»·å€¼æŸå¤±
        "rgba(200, 200, 200, 0.8)",  # æŠ˜æ‰£å›æŠ¥ï¼ˆæ–°å¢èŠ‚ç‚¹ï¼‰
        "rgba(46, 204, 113, 0.8)",   # æ€»æŸå¤±
        "rgba(125, 60, 152, 0.8)",   # å‚æ•°æ›´æ–°
        "rgba(255, 165, 0, 0.8)"     # æ—§ç­–ç•¥åŒæ­¥ï¼ˆæ–°å¢èŠ‚ç‚¹ï¼‰
    ]
)

# å®šä¹‰è¿æ¥å…³ç³»ï¼ˆä¿®æ­£åçš„é€»è¾‘æµï¼‰
links = dict(
    # sourceå’Œtargetç´¢å¼•å¯¹åº”èŠ‚ç‚¹åˆ—è¡¨é¡ºåº
    source = [0, 1, 1, 1, 2, 3, 4, 1, 5, 6, 7, 4, 7, 8, 10, 9, 11, 12],
    target = [1, 2, 5,10, 3, 4, 8, 9, 7, 7, 8, 7,11,11, 9,11,12,13],
    value = [3, 2, 2,2, 2, 2, 3, 2, 2, 2, 3, 2,3,3, 2,2,3,3]
)

fig = go.Figure(go.Sankey(
    node = dict(
        label = nodes["label"],
        color = nodes["color"],
        hovertemplate = "%{label}<extra></extra>",  # ç®€åŒ–æ‚¬åœä¿¡æ¯
        pad = 130  # å¢åŠ èŠ‚ç‚¹é—´è·
    ),
    link = dict(
        source = links["source"],
        target = links["target"],
        value = links["value"],
        color = "rgba(100, 100, 100, 0.3)"  # è¿æ¥çº¿é¢œè‰²
    ),
    arrangement = "snap",
    textfont = dict(size=12)
))

# æ·»åŠ åŠ¨æ€æ³¨é‡Šï¼ˆä¼˜åŒ–æ ¸å¿ƒå…¬å¼æ˜¾ç¤ºï¼‰
fig.add_annotation(
    x=0.6, y=0.98,
    text="<b>PPOæ ¸å¿ƒé€»è¾‘ï¼š</b><br>"
         "1. ç­–ç•¥æ›´æ–°é™åˆ¶ï¼šâ”‚Ï€_Î¸/Ï€_old -1â”‚â‰¤Îµ<br>"
         "2. ä¼˜åŠ¿ä¼°è®¡ï¼šAâ‚œ = ğ”¼[Î´â‚œ + Î³Î»Î´â‚œâ‚Šâ‚ + (Î³Î»)Â²Î´â‚œâ‚Šâ‚‚ +...]<br>"
         "3. åŒé‡ä¼˜åŒ–ï¼šç­–ç•¥Î¸ + ä»·å€¼å‡½æ•°Ï•",
    showarrow=False,
    bordercolor="#2ECC71",
    borderwidth=2,
    bgcolor="white",
    font=dict(size=12, color="#2C3E50"),
    xanchor="right",
    yanchor="top"
)

fig.update_layout(
    title="<b>PPOç®—æ³•å®Œæ•´è®¡ç®—æµ</b>",
    title_x=0.5,
    height=500,
    width=1200,
    margin=dict(l=30, r=30, b=50, t=50),
    hovermode='closest',
    plot_bgcolor='white'
)

fig.show()
